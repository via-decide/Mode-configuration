<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>InterviewOS — Swipe Daily Progress</title>
  <meta name="description" content="Swipe-based interview preparation OS. Autosaves. Copy clean reports." />
  <style>
    :root{
      --bg:#0b0d12;
      --panel:#0f141d;
      --panel2:#0c111a;
      --line:rgba(255,255,255,.10);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.62);
      --muted2:rgba(255,255,255,.45);
      --accent:#8b5cf6;
      --good:#22c55e;
      --warn:#f59e0b;
      --bad:#ef4444;
      --shadow: 0 20px 60px rgba(0,0,0,.55);
      --radius: 18px;
      --radius2: 14px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background: radial-gradient(1200px 800px at 20% -10%, rgba(139,92,246,.25), transparent 55%),
                  radial-gradient(900px 700px at 100% 10%, rgba(34,197,94,.12), transparent 55%),
                  radial-gradient(900px 900px at 30% 120%, rgba(245,158,11,.10), transparent 60%),
                  var(--bg);
      color:var(--text);
      font-family:var(--sans);
      -webkit-font-smoothing:antialiased;
      overflow:hidden;
    }
    a{color:inherit}
    .wrap{
      height:100%;
      display:flex;
      flex-direction:column;
      padding: 18px 14px max(18px, env(safe-area-inset-bottom));
      gap: 12px;
    }
    header{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      padding: 6px 6px 0;
    }
    .brand{
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .brand h1{
      margin:0;
      font-size: 22px;
      letter-spacing:-0.02em;
      line-height:1.05;
    }
    .brand .sub{
      color:var(--muted);
      font-size: 13px;
      line-height:1.2;
    }
    .top-actions{
      display:flex;
      gap:8px;
      align-items:center;
      padding-top:2px;
    }
    .pill{
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      color:var(--text);
      padding: 10px 12px;
      border-radius: 999px;
      font-size: 12px;
      cursor:pointer;
      user-select:none;
      transition: transform .08s ease, background .15s ease, border-color .15s ease;
      display:inline-flex;
      align-items:center;
      gap:8px;
      white-space:nowrap;
    }
    .pill:active{transform: translateY(1px) scale(.99)}
    .pill:hover{background: rgba(255,255,255,.06)}
    .pill.primary{
      border-color: rgba(139,92,246,.55);
      background: rgba(139,92,246,.18);
    }
    .pill.danger{
      border-color: rgba(239,68,68,.55);
      background: rgba(239,68,68,.14);
    }
    .grid{
      flex:1;
      display:flex;
      min-height:0;
    }
    .deck{
      width:100%;
      border-radius: var(--radius);
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
      touch-action: pan-y;
    }
    .deck::before{
      content:"";
      position:absolute;
      inset:0;
      background: radial-gradient(800px 500px at 20% 20%, rgba(139,92,246,.10), transparent 60%),
                  radial-gradient(900px 600px at 80% 10%, rgba(34,197,94,.08), transparent 55%),
                  radial-gradient(900px 700px at 40% 120%, rgba(245,158,11,.06), transparent 60%);
      pointer-events:none;
    }
    .slides{
      height:100%;
      display:flex;
      transition: transform .28s cubic-bezier(.2,.9,.2,1);
      will-change: transform;
    }
    .slide{
      min-width:100%;
      height:100%;
      padding: 14px 14px 16px;
      display:flex;
      flex-direction:column;
      gap:12px;
      position:relative;
    }
    .tag{
      display:flex;
      align-items:center;
      gap:10px;
      justify-content:space-between;
      padding: 10px 12px;
      border-radius: 14px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.22);
      backdrop-filter: blur(10px);
    }
    .tag h2{
      margin:0;
      font-size: 13px;
      letter-spacing: .12em;
      text-transform: uppercase;
      color: rgba(255,255,255,.85);
    }
    .tag .hint{
      font-size: 12px;
      color: var(--muted);
    }
    .card{
      flex:1;
      min-height:0;
      border-radius: var(--radius);
      border:1px solid var(--line);
      background: rgba(0,0,0,.20);
      backdrop-filter: blur(14px);
      padding: 12px;
      overflow:auto;
      -webkit-overflow-scrolling: touch;
    }
    .section-title{
      margin: 2px 0 10px;
      font-size: 16px;
      letter-spacing:-0.01em;
    }
    .small{
      color:var(--muted);
      font-size: 13px;
      line-height: 1.35;
    }
    .form{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-top:10px;
    }
    label{
      font-size: 12px;
      color: var(--muted);
      display:block;
      margin:0 0 6px;
    }
    input[type="text"], input[type="number"], textarea, select{
      width:100%;
      border-radius: 12px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      color: var(--text);
      padding: 12px 12px;
      font-size: 14px;
      outline:none;
    }
    textarea{min-height:110px; resize:vertical}
    input::placeholder, textarea::placeholder{color: rgba(255,255,255,.35)}
    .row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    @media (max-width: 520px){
      .row{grid-template-columns:1fr}
    }

    .choice-row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .choice{
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 999px;
      font-size: 12px;
      cursor:pointer;
      user-select:none;
      transition: background .15s ease, border-color .15s ease, transform .08s ease;
    }
    .choice:hover{background: rgba(255,255,255,.05)}
    .choice:active{transform: translateY(1px)}
    .choice[data-on="1"]{
      border-color: rgba(139,92,246,.6);
      background: rgba(139,92,246,.18);
    }
    .toggle{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      border-radius: 14px;
      padding: 10px 12px;
    }
    .switch{
      width: 44px;
      height: 26px;
      border-radius: 999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.05);
      position:relative;
      cursor:pointer;
      flex: 0 0 auto;
    }
    .switch::after{
      content:"";
      position:absolute;
      top:3px; left:3px;
      width: 18px; height: 18px;
      border-radius: 999px;
      background: rgba(255,255,255,.85);
      transition: transform .16s ease, background .16s ease;
    }
    .switch[data-on="1"]{
      border-color: rgba(34,197,94,.55);
      background: rgba(34,197,94,.18);
    }
    .switch[data-on="1"]::after{
      transform: translateX(18px);
      background: rgba(255,255,255,.92);
    }

    .list{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-top: 6px;
    }
    .item{
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      border-radius: 14px;
      padding: 10px 12px;
      display:flex;
      gap:10px;
      align-items:flex-start;
    }
    .chk{
      width: 18px;
      height: 18px;
      border-radius: 6px;
      border:1px solid var(--line);
      flex:0 0 auto;
      margin-top:2px;
      cursor:pointer;
      background: rgba(0,0,0,.15);
      position:relative;
    }
    .chk[data-on="1"]{
      border-color: rgba(34,197,94,.6);
      background: rgba(34,197,94,.2);
    }
    .chk[data-on="1"]::after{
      content:"";
      position:absolute;
      inset:3px;
      border-radius:4px;
      background: rgba(255,255,255,.86);
      clip-path: polygon(14% 53%, 0 66%, 38% 100%, 100% 23%, 86% 9%, 38% 72%);
    }
    .item .txt{
      flex:1;
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .item .ttl{
      font-size: 14px;
      line-height:1.25;
    }
    .item .meta{
      font-size: 12px;
      color: var(--muted);
    }
    .mini-actions{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin-top:10px;
    }
    .btn{
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      font-size: 13px;
      cursor:pointer;
      user-select:none;
      transition: transform .08s ease, background .15s ease;
    }
    .btn:hover{background: rgba(255,255,255,.06)}
    .btn:active{transform: translateY(1px)}
    .btn.primary{
      border-color: rgba(139,92,246,.55);
      background: rgba(139,92,246,.18);
    }
    .btn.ghost{
      background: transparent;
    }
    .footer-nav{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 8px 10px 10px;
    }
    .dots{
      display:flex;
      align-items:center;
      gap:8px;
    }
    .dot{
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: rgba(255,255,255,.22);
      border: 1px solid rgba(255,255,255,.10);
    }
    .dot[data-on="1"]{
      background: rgba(139,92,246,.85);
      border-color: rgba(139,92,246,.35);
    }
    .pager{
      font-family: var(--mono);
      font-size: 12px;
      color: var(--muted);
      letter-spacing: .04em;
    }
    .toast{
      position: fixed;
      left: 50%;
      bottom: calc(16px + env(safe-area-inset-bottom));
      transform: translateX(-50%);
      background: rgba(0,0,0,.70);
      border:1px solid rgba(255,255,255,.14);
      color: rgba(255,255,255,.92);
      padding: 10px 12px;
      border-radius: 999px;
      font-size: 13px;
      opacity:0;
      pointer-events:none;
      transition: opacity .18s ease, transform .18s ease;
      box-shadow: 0 12px 40px rgba(0,0,0,.35);
      backdrop-filter: blur(10px);
    }
    .toast.on{
      opacity:1;
      transform: translateX(-50%) translateY(-2px);
    }
    .muted-box{
      border:1px dashed rgba(255,255,255,.18);
      background: rgba(255,255,255,.02);
      padding: 10px 12px;
      border-radius: 14px;
      margin-top: 10px;
    }
    .generated{
      white-space: pre-wrap;
      font-family: var(--mono);
      font-size: 12px;
      color: rgba(255,255,255,.84);
      line-height: 1.35;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <h1>InterviewOS</h1>
        <div class="sub">Swipe to plan + log prep • autosaves • copy clean reports</div>
      </div>
      <div class="top-actions">
        <button class="pill" id="btnCopyAll" title="Copy a clean summary report">Copy</button>
        <button class="pill primary" id="btnShareAll" title="Share summary report">Share</button>
        <button class="pill danger" id="btnReset" title="Reset everything">Reset</button>
      </div>
    </header>

    <div class="grid">
      <div class="deck" id="deck" aria-label="Swipe deck">
        <div class="slides" id="slides">
          <!-- Slide 1 -->
          <section class="slide" data-slide="profile">
            <div class="tag">
              <h2>SETUP</h2>
              <div class="hint">Defaults assumed • edit anything</div>
            </div>
            <div class="card">
              <div class="section-title">Student profile</div>
              <div class="small">This drives your plan. Everything saves instantly on change.</div>

              <div class="form" id="profileForm">
                <div>
                  <label for="studentName">Student Name</label>
                  <input id="studentName" type="text" placeholder="Your name" />
                </div>

                <div class="row">
                  <div>
                    <label for="targetRole">Target Company / Role</label>
                    <input id="targetRole" type="text" placeholder="e.g., Backend / System Design" />
                  </div>
                  <div>
                    <label for="timeline">Interview Timeline</label>
                    <select id="timeline">
                      <option value="3–6 Months">3–6 Months</option>
                      <option value="1–3 Months">1–3 Months</option>
                      <option value="6–12 Months">6–12 Months</option>
                      <option value="2–4 Weeks">2–4 Weeks</option>
                    </select>
                  </div>
                </div>

                <div class="row">
                  <div>
                    <label for="level">Current Level</label>
                    <select id="level">
                      <option value="Intermediate">Intermediate</option>
                      <option value="Beginner">Beginner</option>
                      <option value="Advanced">Advanced</option>
                    </select>
                  </div>
                  <div>
                    <label>Deep Dive Mode?</label>
                    <div class="toggle">
                      <div>
                        <div style="font-size:13px;">More depth, more workload</div>
                        <div class="small" style="margin-top:2px;">Adds extra drills + reading.</div>
                      </div>
                      <div class="switch" id="deepDiveSwitch" role="switch" aria-checked="false" tabindex="0"></div>
                    </div>
                  </div>
                </div>

                <div class="muted-box">
                  <div class="small"><b>Assumed defaults applied:</b></div>
                  <div class="small" id="assumptionsText" style="margin-top:6px;"></div>
                </div>
              </div>
            </div>
          </section>

          <!-- Slide 2 -->
          <section class="slide" data-slide="roadmap">
            <div class="tag">
              <h2>ROADMAP</h2>
              <div class="hint">Output-based • tick what’s done</div>
            </div>
            <div class="card">
              <div class="section-title">System Design + Backend roadmap</div>
              <div class="small">Built for your timeline + level. Edit tasks freely.</div>

              <div class="mini-actions">
                <button class="btn primary" id="btnRegenRoadmap">Regenerate</button>
                <button class="btn" id="btnAddRoadmap">Add task</button>
              </div>

              <div class="list" id="roadmapList" aria-label="Roadmap tasks"></div>
            </div>
          </section>

          <!-- Slide 3 -->
          <section class="slide" data-slide="weekly">
            <div class="tag">
              <h2>WEEK</h2>
              <div class="hint">Plan the next 7 days</div>
            </div>
            <div class="card">
              <div class="section-title">Weekly plan</div>
              <div class="small">Pick a focus for each day. Keep it realistic.</div>

              <div class="mini-actions">
                <button class="btn primary" id="btnAutoWeek">Auto-fill week</button>
                <button class="btn" id="btnClearWeek">Clear</button>
              </div>

              <div class="form" id="weekForm"></div>
            </div>
          </section>

          <!-- Slide 4 -->
          <section class="slide" data-slide="daily">
            <div class="tag">
              <h2>TODAY</h2>
              <div class="hint">Swipe → to finish • copy anytime</div>
            </div>
            <div class="card">
              <div class="section-title">Daily check-in</div>
              <div class="small">Log actual output. Not plans.</div>

              <div class="form">
                <div>
                  <label for="focusToday">Focus of the day (1 line)</label>
                  <input id="focusToday" type="text" placeholder="e.g., Design URL shortener + review caching" />
                </div>

                <div>
                  <label>Energy level (tap)</label>
                  <div class="choice-row" id="energyChoices">
                    <div class="choice" data-key="energy" data-value="LOW">LOW</div>
                    <div class="choice" data-key="energy" data-value="MED">MED</div>
                    <div class="choice" data-key="energy" data-value="HIGH">HIGH</div>
                  </div>
                </div>

                <div>
                  <label for="distractions">Distractions (optional)</label>
                  <input id="distractions" type="text" placeholder="e.g., work, travel, sleep debt" />
                </div>

                <hr style="border:none;border-top:1px solid var(--line);margin:4px 0;">

                <div class="row">
                  <div>
                    <label for="hoursStudied">Hours studied (number)</label>
                    <select id="hoursStudied">
                      <option value="">Select…</option>
                      <option>0</option><option>0.5</option><option>1</option><option>1.5</option><option>2</option>
                      <option>2.5</option><option>3</option><option>4</option><option>5</option><option>6+</option>
                    </select>
                  </div>
                  <div>
                    <label for="sleepHours">Sleep (hours)</label>
                    <select id="sleepHours">
                      <option value="">Select…</option>
                      <option>4</option><option>5</option><option>6</option><option>7</option><option>8</option><option>9+</option>
                    </select>
                  </div>
                </div>

                <div>
                  <label for="completed">What did you complete? (bullets ok)</label>
                  <textarea id="completed" placeholder="- Designed APIs&#10;- Did 2 system design mocks&#10;- Solved 3 LC mediums"></textarea>
                </div>

                <div>
                  <label for="keyLearning">One key learning (1 sentence)</label>
                  <input id="keyLearning" type="text" placeholder="e.g., Consistent hashing tradeoffs with virtual nodes." />
                </div>

                <div>
                  <label>Mood (tap)</label>
                  <div class="choice-row" id="moodChoices">
                    <div class="choice" data-key="mood" data-value="GOOD">GOOD</div>
                    <div class="choice" data-key="mood" data-value="OK">OK</div>
                    <div class="choice" data-key="mood" data-value="LOW">LOW</div>
                  </div>
                </div>

                <hr style="border:none;border-top:1px solid var(--line);margin:4px 0;">

                <div>
                  <label for="tomorrowPriority">Tomorrow’s priority (1 line)</label>
                  <input id="tomorrowPriority" type="text" placeholder="e.g., DB indexing + queries practice" />
                </div>

                <div>
                  <label for="blockers">Blockers (if any)</label>
                  <input id="blockers" type="text" placeholder="e.g., unclear requirements, low energy" />
                </div>

                <div class="muted-box">
                  <div class="small"><b>Generated text (auto)</b></div>
                  <div class="generated" id="generatedText" style="margin-top:8px;"></div>
                  <div class="mini-actions" style="margin-top:10px;">
                    <button class="btn primary" id="btnCopyToday">Copy</button>
                    <button class="btn" id="btnShareToday">Share</button>
                  </div>
                </div>

              </div>
            </div>
          </section>
        </div>

        <div class="footer-nav">
          <button class="pill" id="btnPrev" aria-label="Previous">←</button>

          <div class="dots" id="dots" aria-label="Progress dots"></div>

          <div style="display:flex;gap:10px;align-items:center;">
            <div class="pager" id="pager">01/04</div>
            <button class="pill" id="btnNext" aria-label="Next">→</button>
          </div>
        </div>
      </div>
    </div>

    <div class="toast" id="toast">Copied</div>
  </div>

<script>
(function(){
  const STORAGE_KEY = "interviewOS.v1";

  const DEFAULTS = {
    profile: {
      studentName: "",
      targetRole: "Backend / System Design",
      timeline: "3–6 Months",
      level: "Intermediate",
      deepDive: false
    },
    roadmap: [],
    week: {}, // yyyy-mm-dd -> text
    daily: {
      date: todayISO(),
      focusToday: "",
      energy: "",
      distractions: "",
      hoursStudied: "",
      completed: "",
      keyLearning: "",
      sleepHours: "",
      mood: "",
      tomorrowPriority: "",
      blockers: ""
    },
    ui: {
      slideIndex: 0
    }
  };

  const deck = $("#deck");
  const slidesEl = $("#slides");
  const toastEl = $("#toast");
  const pagerEl = $("#pager");
  const dotsEl = $("#dots");

  const btnPrev = $("#btnPrev");
  const btnNext = $("#btnNext");
  const btnReset = $("#btnReset");
  const btnCopyAll = $("#btnCopyAll");
  const btnShareAll = $("#btnShareAll");

  const btnCopyToday = $("#btnCopyToday");
  const btnShareToday = $("#btnShareToday");

  const studentNameEl = $("#studentName");
  const targetRoleEl = $("#targetRole");
  const timelineEl = $("#timeline");
  const levelEl = $("#level");
  const deepDiveSwitch = $("#deepDiveSwitch");
  const assumptionsText = $("#assumptionsText");

  const btnRegenRoadmap = $("#btnRegenRoadmap");
  const btnAddRoadmap = $("#btnAddRoadmap");
  const roadmapList = $("#roadmapList");

  const btnAutoWeek = $("#btnAutoWeek");
  const btnClearWeek = $("#btnClearWeek");
  const weekForm = $("#weekForm");

  const focusTodayEl = $("#focusToday");
  const distractionsEl = $("#distractions");
  const hoursStudiedEl = $("#hoursStudied");
  const completedEl = $("#completed");
  const keyLearningEl = $("#keyLearning");
  const sleepHoursEl = $("#sleepHours");
  const tomorrowPriorityEl = $("#tomorrowPriority");
  const blockersEl = $("#blockers");
  const generatedTextEl = $("#generatedText");

  const energyChoices = $("#energyChoices");
  const moodChoices = $("#moodChoices");

  const SLIDE_COUNT = 4;

  let state = loadState();

  // ---------- init ----------
  ensureRoadmap();
  ensureWeekFields();
  bindUI();
  renderAll();
  goToSlide(state.ui.slideIndex || 0, {immediate:true});

  // ---------- state helpers ----------
  function todayISO(){
    const d = new Date();
    const y = d.getFullYear();
    const m = String(d.getMonth()+1).padStart(2,"0");
    const dd = String(d.getDate()).padStart(2,"0");
    return `${y}-${m}-${dd}`;
  }

  function loadState(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return structuredClone(DEFAULTS);
      const parsed = JSON.parse(raw);
      return mergeDeep(structuredClone(DEFAULTS), parsed);
    }catch(e){
      return structuredClone(DEFAULTS);
    }
  }

  function saveState(){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
  }

  function mergeDeep(target, src){
    for(const k in src){
      if(src[k] && typeof src[k] === "object" && !Array.isArray(src[k])){
        target[k] = mergeDeep(target[k] || {}, src[k]);
      }else{
        target[k] = src[k];
      }
    }
    return target;
  }

  function ensureRoadmap(){
    if(Array.isArray(state.roadmap) && state.roadmap.length) return;
    state.roadmap = buildRoadmap(state.profile);
    saveState();
  }

  function ensureWeekFields(){
    // Make sure we have 7 entries starting today
    const days = next7Days();
    for(const d of days){
      if(typeof state.week[d] !== "string") state.week[d] = "";
    }
    saveState();
  }

  // ---------- roadmap generation ----------
  function buildRoadmap(profile){
    const {timeline, level, deepDive} = profile || DEFAULTS.profile;

    const intensity = deepDive ? 1.25 : 1.0;
    const timeBucket = (timeline || "3–6 Months").toLowerCase();

    const core = [
      t("Foundations: CAP theorem, consistency models, latency vs throughput, availability", "Read + 10 notes"),
      t("Networking: HTTP/1.1 vs HTTP/2, gRPC basics, load balancers, CDN", "1 mock + summary"),
      t("Datastores: indexing, replication, sharding, transactions, isolation levels", "Implement notes"),
      t("Caching: local vs distributed, eviction, cache stampede, write strategies", "Design 2 patterns"),
      t("Messaging: queues vs streams, backpressure, retries, DLQ, idempotency", "Design + tradeoffs"),
      t("Reliability: SLO/SLI, error budgets, rate limiting, circuit breakers", "Create checklist"),
      t("Observability: logs, metrics, tracing, RED/USE", "Instrument a toy service"),
      t("Security: authn/authz, JWT sessions, secrets, OWASP basics", "Threat model 1 system"),
      t("API design: pagination, versioning, contracts, backward compatibility", "Write 3 APIs"),
      t("DB practice: schema design, queries, explain plans (your DB)", "20 query drills"),
      t("Coding prep: DS/Algo weak spots", "15 medium problems"),
      t("System design mocks: end-to-end", "6 mocks total")
    ];

    const deep = [
      t("Consistency deep dive: quorum, leaderless, CRDTs (overview)", "Write 1 page summary"),
      t("Distributed locks + leader election basics", "Notes + pitfalls"),
      t("Data pipelines: ETL vs ELT, batch vs stream, exactly-once semantics (concepts)", "1 design doc"),
      t("Performance: profiling, N+1, connection pooling, p99 work", "Fix 1 bottleneck"),
      t("Infra: containers, orchestration basics, autoscaling", "Deploy a toy service"),
      t("Interview narratives: STAR stories + project deep dives", "Write 8 stories")
    ];

    const interviewSoon = timeBucket.includes("week") || timeBucket.includes("1–3") || timeBucket.includes("1-3");
    const beginner = (level || "").toLowerCase().includes("begin");
    const advanced = (level || "").toLowerCase().includes("adv");

    let list = [...core];

    // adjust for level
    if(beginner){
      list.unshift(
        t("Backend basics: REST, JSON, status codes, concurrency basics", "Notes + mini API"),
        t("SQL basics: joins, indexes, normalization vs denormalization", "10 drills")
      );
    }
    if(advanced){
      list = list.filter(x => !x.title.toLowerCase().includes("coding prep"));
      list.unshift(
        t("Advanced tradeoffs: multi-region, disaster recovery, failover", "Write DR plan"),
        t("Capacity planning: QPS, storage, bandwidth, p99 + headroom", "3 estimates")
      );
      list.push(
        t("Leadership: drive the interview (clarify, enumerate, choose, justify)", "Run 3 mocks")
      );
    }

    // timeline: if soon, prioritize mocks + essentials
    if(interviewSoon){
      list = prioritize(list, [
        "System design mocks",
        "Capacity planning",
        "Datastores",
        "Caching",
        "Messaging",
        "Reliability",
        "API design",
        "Interview narratives"
      ]);
      // add quick cadence tasks
      list.unshift(
        t("Daily cadence: 60–90m DS/Algo + 60m system design + 15m notes", "Follow 10 days"),
      );
    }

    if(deepDive){
      list = [...list, ...deep];
    }

    // Apply intensity by adding optional repeats
    if(intensity > 1.0){
      list.push(
        t("Extra mocks: 2 additional system design mocks", "2 mocks"),
        t("Extra review: revisit your top 10 notes", "Refine + condense")
      );
    }

    // Normalize ids
    return list.map((x, idx) => ({...x, id: `rm_${idx+1}`, done: !!x.done}));
  }

  function t(title, meta){
    return { title, meta };
  }

  function prioritize(list, keywords){
    const score = (it) => {
      const s = (it.title + " " + (it.meta||"")).toLowerCase();
      let best = 0;
      for(let i=0;i<keywords.length;i++){
        const k = keywords[i].toLowerCase();
        if(s.includes(k.toLowerCase())) best = Math.max(best, keywords.length - i);
      }
      return best;
    };
    return [...list].sort((a,b)=> score(b)-score(a));
  }

  // ---------- UI binding ----------
  function bindUI(){
    // profile
    studentNameEl.addEventListener("input", () => setProfile("studentName", studentNameEl.value));
    targetRoleEl.addEventListener("input", () => setProfile("targetRole", targetRoleEl.value));
    timelineEl.addEventListener("change", () => setProfile("timeline", timelineEl.value, {regen:true}));
    levelEl.addEventListener("change", () => setProfile("level", levelEl.value, {regen:true}));

    deepDiveSwitch.addEventListener("click", () => toggleDeepDive());
    deepDiveSwitch.addEventListener("keydown", (e) => {
      if(e.key === "Enter" || e.key === " "){ e.preventDefault(); toggleDeepDive(); }
    });

    // roadmap
    btnRegenRoadmap.addEventListener("click", () => {
      state.roadmap = buildRoadmap(state.profile);
      saveState();
      renderRoadmap();
      toast("Regenerated");
    });
    btnAddRoadmap.addEventListener("click", () => {
      const title = prompt("Task title?");
      if(!title) return;
      const meta = prompt("Output metric? (optional)") || "";
      state.roadmap.push({id: `rm_${Date.now()}`, title, meta, done:false});
      saveState();
      renderRoadmap();
    });

    // week
    btnAutoWeek.addEventListener("click", () => {
      autoFillWeek();
      saveState();
      renderWeek();
      toast("Week filled");
    });
    btnClearWeek.addEventListener("click", () => {
      for(const d of next7Days()) state.week[d] = "";
      saveState();
      renderWeek();
      toast("Cleared");
    });

    // daily
    focusTodayEl.addEventListener("input", () => setDaily("focusToday", focusTodayEl.value));
    distractionsEl.addEventListener("input", () => setDaily("distractions", distractionsEl.value));
    hoursStudiedEl.addEventListener("change", () => setDaily("hoursStudied", hoursStudiedEl.value));
    completedEl.addEventListener("input", () => setDaily("completed", completedEl.value));
    keyLearningEl.addEventListener("input", () => setDaily("keyLearning", keyLearningEl.value));
    sleepHoursEl.addEventListener("change", () => setDaily("sleepHours", sleepHoursEl.value));
    tomorrowPriorityEl.addEventListener("input", () => setDaily("tomorrowPriority", tomorrowPriorityEl.value));
    blockersEl.addEventListener("input", () => setDaily("blockers", blockersEl.value));

    energyChoices.addEventListener("click", (e) => {
      const el = e.target.closest(".choice");
      if(!el) return;
      setDaily("energy", el.dataset.value);
    });
    moodChoices.addEventListener("click", (e) => {
      const el = e.target.closest(".choice");
      if(!el) return;
      setDaily("mood", el.dataset.value);
    });

    btnCopyToday.addEventListener("click", () => copyText(buildTodayReport()));
    btnShareToday.addEventListener("click", () => shareText(buildTodayReport()));

    btnCopyAll.addEventListener("click", () => copyText(buildFullReport()));
    btnShareAll.addEventListener("click", () => shareText(buildFullReport()));

    btnReset.addEventListener("click", () => {
      const ok = confirm("Reset everything? This clears all saved data.");
      if(!ok) return;
      state = structuredClone(DEFAULTS);
      state.profile = structuredClone(DEFAULTS.profile);
      state.profile.targetRole = "Backend / System Design";
      state.profile.timeline = "3–6 Months";
      state.profile.level = "Intermediate";
      state.profile.deepDive = false;
      state.daily.date = todayISO();
      state.roadmap = buildRoadmap(state.profile);
      ensureWeekFields();
      saveState();
      renderAll();
      goToSlide(0);
      toast("Reset");
    });

    // nav
    btnPrev.addEventListener("click", () => goToSlide((state.ui.slideIndex||0) - 1));
    btnNext.addEventListener("click", () => goToSlide((state.ui.slideIndex||0) + 1));

    // swipe
    bindSwipe(deck);
  }

  function setProfile(key, value, opts={}){
    state.profile[key] = value;
    saveState();
    renderAssumptions();
    if(opts.regen){
      state.roadmap = buildRoadmap(state.profile);
      saveState();
      renderRoadmap();
    }
    renderGenerated();
  }

  function toggleDeepDive(){
    state.profile.deepDive = !state.profile.deepDive;
    saveState();
    deepDiveSwitch.dataset.on = state.profile.deepDive ? "1" : "0";
    deepDiveSwitch.setAttribute("aria-checked", state.profile.deepDive ? "true" : "false");
    state.roadmap = buildRoadmap(state.profile);
    saveState();
    renderRoadmap();
    renderAssumptions();
    renderGenerated();
    toast(state.profile.deepDive ? "Deep Dive: ON" : "Deep Dive: OFF");
  }

  function setDaily(key, value){
    // If date changed (new day), keep previous but overwrite today's bucket
    const iso = todayISO();
    if(state.daily.date !== iso){
      state.daily = {...structuredClone(DEFAULTS.daily), date: iso};
    }
    state.daily[key] = value;
    saveState();
    renderDailyChoices();
    renderGenerated();
  }

  // ---------- rendering ----------
  function renderAll(){
    // profile values
    studentNameEl.value = state.profile.studentName || "";
    targetRoleEl.value = state.profile.targetRole || "";
    timelineEl.value = state.profile.timeline || "3–6 Months";
    levelEl.value = state.profile.level || "Intermediate";
    deepDiveSwitch.dataset.on = state.profile.deepDive ? "1" : "0";
    deepDiveSwitch.setAttribute("aria-checked", state.profile.deepDive ? "true" : "false");

    renderAssumptions();
    renderRoadmap();
    renderWeek();
    renderDaily();
    renderDots();
    renderPager();
    renderGenerated();
  }

  function renderAssumptions(){
    const a = [
      `Target Company / Role: ${DEFAULTS.profile.targetRole} (Default Assumed)`,
      `Interview Timeline: ${DEFAULTS.profile.timeline} (Default Assumed)`,
      `Current Level: ${DEFAULTS.profile.level} (Default Assumed)`,
      `Deep Dive Mode: ${DEFAULTS.profile.deepDive ? "Yes" : "No"} (Default Assumed)`
    ];
    assumptionsText.textContent = a.join("\n");
  }

  function renderRoadmap(){
    roadmapList.innerHTML = "";
    state.roadmap.forEach((it, idx) => {
      const row = document.createElement("div");
      row.className = "item";
      row.innerHTML = `
        <div class="chk" data-id="${escapeHtml(it.id)}" data-on="${it.done?1:0}" role="checkbox" aria-checked="${it.done?"true":"false"}" tabindex="0"></div>
        <div class="txt">
          <div class="ttl" contenteditable="true" data-edit="title" data-id="${escapeHtml(it.id)}"></div>
          <div class="meta" contenteditable="true" data-edit="meta" data-id="${escapeHtml(it.id)}"></div>
        </div>
        <button class="btn ghost" data-del="${escapeHtml(it.id)}" title="Delete">✕</button>
      `;
      row.querySelector('[data-edit="title"]').textContent = it.title || "";
      row.querySelector('[data-edit="meta"]').textContent = it.meta || "";
      roadmapList.appendChild(row);
    });

    // checkbox toggles + delete + editing
    roadmapList.querySelectorAll(".chk").forEach(chk => {
      chk.addEventListener("click", () => toggleRoadmap(chk.dataset.id));
      chk.addEventListener("keydown", (e) => {
        if(e.key==="Enter"||e.key===" "){ e.preventDefault(); toggleRoadmap(chk.dataset.id); }
      });
    });
    roadmapList.querySelectorAll("button[data-del]").forEach(btn => {
      btn.addEventListener("click", () => {
        const id = btn.dataset.del;
        state.roadmap = state.roadmap.filter(x => x.id !== id);
        saveState();
        renderRoadmap();
      });
    });
    roadmapList.querySelectorAll("[contenteditable][data-edit]").forEach(el => {
      el.addEventListener("input", () => {
        const id = el.dataset.id;
        const field = el.dataset.edit;
        const item = state.roadmap.find(x => x.id === id);
        if(!item) return;
        item[field] = el.textContent.trim();
        saveState();
      });
    });
  }

  function toggleRoadmap(id){
    const item = state.roadmap.find(x => x.id === id);
    if(!item) return;
    item.done = !item.done;
    saveState();
    renderRoadmap();
  }

  function renderWeek(){
    weekForm.innerHTML = "";
    const days = next7Days();
    days.forEach((iso, i) => {
      const d = new Date(iso + "T00:00:00");
      const label = d.toLocaleDateString(undefined, {weekday:"short", month:"short", day:"numeric"});
      const wrap = document.createElement("div");
      wrap.innerHTML = `
        <label for="wk_${iso}">${label}</label>
        <input id="wk_${iso}" type="text" placeholder="Focus for the day" />
      `;
      const input = wrap.querySelector("input");
      input.value = state.week[iso] || "";
      input.addEventListener("input", () => {
        state.week[iso] = input.value;
        saveState();
        renderGenerated();
      });
      weekForm.appendChild(wrap);
    });
  }

  function renderDaily(){
    // If stale date, reset only daily section
    const iso = todayISO();
    if(state.daily.date !== iso){
      state.daily = {...structuredClone(DEFAULTS.daily), date: iso};
      saveState();
    }
    focusTodayEl.value = state.daily.focusToday || "";
    distractionsEl.value = state.daily.distractions || "";
    hoursStudiedEl.value = state.daily.hoursStudied || "";
    completedEl.value = state.daily.completed || "";
    keyLearningEl.value = state.daily.keyLearning || "";
    sleepHoursEl.value = state.daily.sleepHours || "";
    tomorrowPriorityEl.value = state.daily.tomorrowPriority || "";
    blockersEl.value = state.daily.blockers || "";
    renderDailyChoices();
  }

  function renderDailyChoices(){
    setChoiceGroup(energyChoices, state.daily.energy);
    setChoiceGroup(moodChoices, state.daily.mood);
  }

  function setChoiceGroup(container, value){
    container.querySelectorAll(".choice").forEach(el => {
      el.dataset.on = (el.dataset.value === value) ? "1" : "0";
    });
  }

  function renderGenerated(){
    generatedTextEl.textContent = buildTodayReport();
  }

  function renderDots(){
    dotsEl.innerHTML = "";
    for(let i=0;i<SLIDE_COUNT;i++){
      const dot = document.createElement("div");
      dot.className = "dot";
      dot.dataset.on = (i === (state.ui.slideIndex||0)) ? "1" : "0";
      dot.title = `Go to ${i+1}`;
      dot.style.cursor = "pointer";
      dot.addEventListener("click", () => goToSlide(i));
      dotsEl.appendChild(dot);
    }
  }

  function renderPager(){
    const i = (state.ui.slideIndex||0);
    pagerEl.textContent = `${String(i+1).padStart(2,"0")}/${String(SLIDE_COUNT).padStart(2,"0")}`;
    renderDots();
  }

  // ---------- navigation + swipe ----------
  function goToSlide(i, {immediate=false}={}){
    const idx = clamp(i, 0, SLIDE_COUNT-1);
    state.ui.slideIndex = idx;
    saveState();
    slidesEl.style.transitionDuration = immediate ? "0ms" : "";
    slidesEl.style.transform = `translateX(${-idx*100}%)`;
    requestAnimationFrame(() => { slidesEl.style.transitionDuration = ""; });
    renderPager();
  }

  function bindSwipe(el){
    let startX=0, startY=0, dragging=false, moved=false;
    let lastX=0;

    el.addEventListener("pointerdown", (e) => {
      if(e.pointerType === "mouse" && e.button !== 0) return;
      // prevent swiping when user is interacting inside input/textarea/select/contenteditable
      const t = e.target;
      if(isInteractive(t)) return;
      dragging = true;
      moved = false;
      startX = e.clientX;
      startY = e.clientY;
      lastX = startX;
      el.setPointerCapture(e.pointerId);
    });

    el.addEventListener("pointermove", (e) => {
      if(!dragging) return;
      const dx = e.clientX - startX;
      const dy = e.clientY - startY;

      if(!moved){
        if(Math.abs(dy) > Math.abs(dx)) return; // vertical scroll intent
        moved = true;
      }
      lastX = e.clientX;

      // follow finger
      const idx = (state.ui.slideIndex||0);
      const pct = (dx / el.clientWidth) * 100;
      slidesEl.style.transitionDuration = "0ms";
      slidesEl.style.transform = `translateX(${(-idx*100) + pct}%)`;
    });

    el.addEventListener("pointerup", (e) => {
      if(!dragging) return;
      dragging = false;
      const dx = lastX - startX;
      slidesEl.style.transitionDuration = "";
      if(Math.abs(dx) > el.clientWidth * 0.18){
        if(dx < 0) goToSlide((state.ui.slideIndex||0) + 1);
        else goToSlide((state.ui.slideIndex||0) - 1);
      }else{
        goToSlide(state.ui.slideIndex||0);
      }
    });

    el.addEventListener("pointercancel", () => {
      if(!dragging) return;
      dragging = false;
      goToSlide(state.ui.slideIndex||0);
    });
  }

  function isInteractive(node){
    if(!node) return false;
    if(node.closest("input,textarea,select,button,[contenteditable='true']")) return true;
    return false;
  }

  // ---------- reports ----------
  function buildTodayReport(){
    const p = state.profile || DEFAULTS.profile;
    const d = state.daily || DEFAULTS.daily;
    const iso = todayISO();
    const datePretty = new Date(iso+"T00:00:00").toLocaleDateString(undefined, {weekday:"short", year:"numeric", month:"short", day:"numeric"});

    const lines = [];
    lines.push(`InterviewOS — Daily Report`);
    lines.push(`${datePretty}`);
    lines.push(``);
    lines.push(`Student: ${safe(p.studentName) || "_________"}`);
    lines.push(`Target: ${safe(p.targetRole) || DEFAULTS.profile.targetRole}`);
    lines.push(`Timeline: ${safe(p.timeline) || DEFAULTS.profile.timeline} • Level: ${safe(p.level) || DEFAULTS.profile.level} • Deep Dive: ${p.deepDive ? "Yes" : "No"}`);
    lines.push(``);
    if(d.focusToday) lines.push(`Focus: ${safe(d.focusToday)}`);
    if(d.energy) lines.push(`Energy: ${safe(d.energy)}`);
    if(d.distractions) lines.push(`Distractions: ${safe(d.distractions)}`);
    if(d.hoursStudied) lines.push(`Hours: ${safe(d.hoursStudied)}`);
    if(d.sleepHours) lines.push(`Sleep: ${safe(d.sleepHours)}h`);
    if(d.mood) lines.push(`Mood: ${safe(d.mood)}`);
    lines.push(``);

    if(d.completed){
      lines.push(`Completed:`);
      lines.push(formatBullets(d.completed));
      lines.push(``);
    }

    if(d.keyLearning) lines.push(`Key learning: ${safe(d.keyLearning)}`);
    if(d.tomorrowPriority) lines.push(`Tomorrow: ${safe(d.tomorrowPriority)}`);
    if(d.blockers) lines.push(`Blockers: ${safe(d.blockers)}`);

    // If empty, keep it minimal
    return lines.join("\n").trim() + "\n";
  }

  function buildFullReport(){
    const p = state.profile || DEFAULTS.profile;
    const done = (state.roadmap||[]).filter(x => x.done).length;
    const total = (state.roadmap||[]).length || 0;
    const iso = todayISO();
    const datePretty = new Date(iso+"T00:00:00").toLocaleDateString(undefined, {weekday:"short", year:"numeric", month:"short", day:"numeric"});

    const lines = [];
    lines.push(`InterviewOS — Summary`);
    lines.push(`${datePretty}`);
    lines.push(``);
    lines.push(`Student: ${safe(p.studentName) || "_________"}`);
    lines.push(`Target: ${safe(p.targetRole) || DEFAULTS.profile.targetRole}`);
    lines.push(`Timeline: ${safe(p.timeline) || DEFAULTS.profile.timeline} • Level: ${safe(p.level) || DEFAULTS.profile.level} • Deep Dive: ${p.deepDive ? "Yes" : "No"}`);
    lines.push(``);
    lines.push(`Roadmap progress: ${done}/${total}`);
    lines.push(``);

    // Next up: first 5 undone tasks
    const next = (state.roadmap||[]).filter(x => !x.done).slice(0,5);
    if(next.length){
      lines.push(`Next tasks:`);
      next.forEach((x, i) => lines.push(`- ${safe(x.title)}${x.meta ? " — " + safe(x.meta) : ""}`));
      lines.push(``);
    }

    // Week
    lines.push(`Week plan (next 7 days):`);
    for(const isoDay of next7Days()){
      const d = new Date(isoDay+"T00:00:00");
      const label = d.toLocaleDateString(undefined, {weekday:"short", month:"short", day:"numeric"});
      const v = (state.week && state.week[isoDay]) ? state.week[isoDay].trim() : "";
      lines.push(`- ${label}: ${v || "—"}`);
    }
    lines.push(``);
    lines.push(buildTodayReport().trim());

    return lines.join("\n").trim() + "\n";
  }

  function formatBullets(text){
    const raw = String(text||"").split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
    if(!raw.length) return "-";
    const out = raw.map(line => {
      if(line.startsWith("-")) return line;
      if(line.startsWith("•")) return "- " + line.slice(1).trim();
      return "- " + line;
    });
    return out.join("\n");
  }

  // ---------- week autofill ----------
  function autoFillWeek(){
    // Use first undone roadmap items, distribute across 7 days
    const undone = (state.roadmap||[]).filter(x => !x.done);
    const picks = undone.slice(0, 7);
    const days = next7Days();
    for(let i=0;i<days.length;i++){
      const task = picks[i];
      state.week[days[i]] = task ? task.title : state.week[days[i]] || "";
    }
  }

  function next7Days(){
    const out = [];
    const now = new Date();
    for(let i=0;i<7;i++){
      const d = new Date(now);
      d.setDate(now.getDate()+i);
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,"0");
      const dd = String(d.getDate()).padStart(2,"0");
      out.push(`${y}-${m}-${dd}`);
    }
    return out;
  }

  // ---------- clipboard/share ----------
  async function copyText(text){
    try{
      await navigator.clipboard.writeText(text);
      toast("Copied");
    }catch(e){
      // fallback
      const ta = document.createElement("textarea");
      ta.value = text;
      ta.style.position = "fixed";
      ta.style.left = "-9999px";
      document.body.appendChild(ta);
      ta.select();
      try{ document.execCommand("copy"); toast("Copied"); }
      catch(err){ toast("Copy failed"); }
      document.body.removeChild(ta);
    }
  }

  async function shareText(text){
    try{
      if(navigator.share){
        await navigator.share({text});
        toast("Shared");
      }else{
        await copyText(text);
      }
    }catch(e){
      // user cancelled; ignore
    }
  }

  // ---------- misc ----------
  function toast(msg){
    toastEl.textContent = msg;
    toastEl.classList.add("on");
    clearTimeout(toastEl._t);
    toastEl._t = setTimeout(() => toastEl.classList.remove("on"), 1200);
  }

  function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }
  function $(sel){ return document.querySelector(sel); }

  function safe(v){
    return String(v ?? "").replace(/[\u0000-\u001F]/g, "").trim();
  }

  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
  }

})();
</script>
</body>
</html>
```0 [❶](code://python)
